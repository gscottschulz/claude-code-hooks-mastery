# Claude Code Hooks - Log Files Documentation

This directory contains JSON logs generated by Claude Code hooks during runtime. All log files are **gitignored** and created automatically when hooks execute.

## Log File Structure

Each log file follows a consistent pattern:
- **Format**: Newline-delimited JSON (JSONL) - one JSON object per line
- **Appending**: Most logs append new entries (except `chat.json` which overwrites)
- **Timestamps**: ISO 8601 format (e.g., `2024-01-20T15:30:45.123Z`)
- **Session Tracking**: Each entry includes `session_id` for correlation

## Log Files Reference

### user_prompt_submit.json
**Hook**: UserPromptSubmit
**Fires**: When user submits a prompt (before Claude processes it)
**Contains**: User prompt submissions with validation metadata

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:30:45.123Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "prompt": "Create a new API endpoint for user authentication",
  "prompt_length": 45,
  "hook_type": "UserPromptSubmit"
}
```

**Use Cases**:
- Audit trail of all user requests
- Security analysis of prompt patterns
- Understanding user intent over time

---

### pre_tool_use.json
**Hook**: PreToolUse
**Fires**: Before any tool execution
**Contains**: Tool usage attempts with security checks

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:31:12.456Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "tool_name": "Bash",
  "tool_input": {
    "command": "ls -la /home/user/project",
    "description": "List project files"
  },
  "blocked": false,
  "reason": null,
  "hook_type": "PreToolUse"
}
```

**Blocked Command Example**:
```json
{
  "timestamp": "2024-01-20T15:32:00.789Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "tool_name": "Bash",
  "tool_input": {
    "command": "rm -rf /",
    "description": "Delete all files"
  },
  "blocked": true,
  "reason": "BLOCKED: Dangerous rm command detected - prevents system-wide deletion",
  "hook_type": "PreToolUse"
}
```

**Use Cases**:
- Security audit of blocked commands
- Understanding tool usage patterns
- Debugging permission issues

---

### post_tool_use.json
**Hook**: PostToolUse
**Fires**: After tool execution completes
**Contains**: Tool execution results and outcomes

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:31:15.234Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "tool_name": "Read",
  "tool_input": {
    "file_path": "/home/user/project/README.md"
  },
  "tool_response": {
    "content": "# Project Title\n\nProject description...",
    "success": true
  },
  "execution_time_ms": 42,
  "hook_type": "PostToolUse"
}
```

**Use Cases**:
- Performance monitoring of tool executions
- Debugging failed tool calls
- Understanding conversation flow

---

### notification.json
**Hook**: Notification
**Fires**: When Claude Code sends notifications
**Contains**: System notifications and alerts

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:33:22.567Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Waiting for user input...",
  "notification_type": "waiting_for_input",
  "tts_played": true,
  "hook_type": "Notification"
}
```

**Use Cases**:
- Tracking when Claude needs user input
- Monitoring TTS announcements
- Understanding conversation pauses

---

### stop.json
**Hook**: Stop
**Fires**: When Claude finishes responding
**Contains**: Completion events with AI-generated messages

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:35:45.890Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "stop_hook_active": true,
  "completion_message": "Task completed successfully. All files have been updated.",
  "llm_provider": "openai",
  "model": "gpt-4",
  "tts_played": true,
  "tts_provider": "elevenlabs",
  "hook_type": "Stop"
}
```

**Fallback Example** (no LLM available):
```json
{
  "timestamp": "2024-01-20T15:36:00.123Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "stop_hook_active": true,
  "completion_message": "Operation complete.",
  "llm_provider": "random_fallback",
  "model": null,
  "tts_played": false,
  "hook_type": "Stop"
}
```

**Use Cases**:
- Tracking conversation completions
- Monitoring TTS announcements
- Understanding LLM provider usage

---

### subagent_stop.json
**Hook**: SubagentStop
**Fires**: When a sub-agent finishes responding
**Contains**: Sub-agent completion events

**Example Entry**:
```json
{
  "timestamp": "2024-01-20T15:40:12.345Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "subagent_name": "crypto-market-agent",
  "stop_hook_active": true,
  "completion_message": "Subagent Complete",
  "tts_played": true,
  "tts_provider": "elevenlabs",
  "hook_type": "SubagentStop"
}
```

**Use Cases**:
- Tracking sub-agent task completions
- Monitoring agent delegation patterns
- Debugging multi-agent workflows

---

### pre_compact.json
**Hook**: PreCompact
**Fires**: Before Claude performs context compaction
**Contains**: Compaction events with trigger type

**Example Entry** (Manual Compaction):
```json
{
  "timestamp": "2024-01-20T16:00:00.000Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "trigger": "manual",
  "custom_instructions": "Preserve all code examples and remove redundant explanations",
  "transcript_backup": "/home/user/.claude/transcripts/backup_2024-01-20_16-00-00.jsonl",
  "hook_type": "PreCompact"
}
```

**Example Entry** (Auto Compaction):
```json
{
  "timestamp": "2024-01-20T16:15:30.456Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "trigger": "auto",
  "custom_instructions": null,
  "transcript_backup": "/home/user/.claude/transcripts/backup_2024-01-20_16-15-30.jsonl",
  "hook_type": "PreCompact"
}
```

**Use Cases**:
- Tracking when context windows fill up
- Preserving transcript history
- Understanding compaction patterns

---

### session_start.json
**Hook**: SessionStart
**Fires**: When Claude starts or resumes a session
**Contains**: Session initialization with source type

**Example Entry** (New Session):
```json
{
  "timestamp": "2024-01-20T14:00:00.000Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "source": "startup",
  "context_loaded": {
    "git_branch": "main",
    "git_status": "clean",
    "recent_issues": [],
    "context_files_loaded": 3
  },
  "hook_type": "SessionStart"
}
```

**Example Entry** (Resume Session):
```json
{
  "timestamp": "2024-01-20T14:30:00.000Z",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "source": "resume",
  "context_loaded": {
    "previous_prompts": 15,
    "session_duration_minutes": 45
  },
  "hook_type": "SessionStart"
}
```

**Use Cases**:
- Understanding session lifecycle
- Tracking development context loading
- Monitoring session resumption patterns

---

### chat.json
**Hook**: PostToolUse (with `--chat` flag)
**Fires**: After each tool use, continuously updated
**Contains**: Full readable conversation transcript

**Important**: This file is **overwritten** each session (not appended). It contains only the most recent conversation.

**Structure**:
```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "started_at": "2024-01-20T14:00:00.000Z",
  "messages": [
    {
      "role": "user",
      "content": "Create a new API endpoint",
      "timestamp": "2024-01-20T14:00:05.123Z"
    },
    {
      "role": "assistant",
      "content": "I'll create a new API endpoint...",
      "timestamp": "2024-01-20T14:00:10.456Z"
    },
    {
      "role": "tool_use",
      "tool": "Write",
      "input": {
        "file_path": "/home/user/project/api/endpoints.py",
        "content": "def new_endpoint():..."
      },
      "result": "success",
      "timestamp": "2024-01-20T14:00:15.789Z"
    }
  ],
  "total_messages": 3,
  "last_updated": "2024-01-20T14:00:15.789Z"
}
```

**Use Cases**:
- Human-readable conversation review
- Debugging conversation flow
- Sharing conversation context
- Training data for custom models

---

## Reading Log Files

### Using jq (recommended)
```bash
# Pretty print entire log
cat logs/user_prompt_submit.json | jq '.'

# Filter by session
cat logs/pre_tool_use.json | jq 'select(.session_id == "550e8400-e29b-41d4-a716")'

# Count blocked commands
cat logs/pre_tool_use.json | jq 'select(.blocked == true)' | wc -l

# Extract completion messages
cat logs/stop.json | jq '.completion_message'

# Get latest chat transcript
cat logs/chat.json | jq '.'
```

### Manual Analysis
Each log file is JSONL (newline-delimited JSON):
- Each line is a complete, valid JSON object
- Lines can be processed independently
- Safe for streaming and incremental parsing

## Log Rotation

**Current Behavior**: Logs grow indefinitely (no rotation)

**Manual Cleanup**:
```bash
# Backup logs
cp -r logs/ logs_backup_$(date +%Y%m%d)/

# Clear all logs (except chat.json which auto-regenerates)
rm logs/*.json
```

**Recommended**: Implement log rotation for production use:
- Archive logs older than 30 days
- Compress archived logs
- Set maximum log file size limits

## Privacy & Security

**Sensitive Data Warning**: Log files may contain:
- User prompts (potentially including passwords, API keys)
- File contents from tool executions
- Command outputs with sensitive information

**Best Practices**:
- Never commit `logs/` directory (already in `.gitignore`)
- Review logs before sharing
- Implement automatic redaction for secrets
- Use encryption for log storage in production

## Troubleshooting

### Logs Not Appearing
1. Check hook configuration in `.claude/settings.json`
2. Verify UV is installed: `uv --version`
3. Check hook script permissions: `ls -l .claude/hooks/`
4. Run hook manually to test: `echo '{"test":true}' | uv run .claude/hooks/user_prompt_submit.py`

### Malformed JSON
1. Validate JSON: `cat logs/user_prompt_submit.json | jq '.' > /dev/null`
2. Check for incomplete writes (hook timeouts)
3. Review hook error handling in Python scripts

### Large Log Files
1. Check file sizes: `du -h logs/*.json`
2. Archive old entries
3. Implement log rotation
4. Consider sampling instead of full logging

## Hook Execution Order

Understanding the hook lifecycle helps interpret logs:

1. **SessionStart** - Session begins
2. **UserPromptSubmit** - User sends prompt
3. **PreToolUse** - Before each tool call
4. **PostToolUse** - After each tool completes
5. **Notification** - When Claude needs input
6. **Stop** - Claude finishes response
7. **SubagentStop** - Sub-agent completes (if used)
8. **PreCompact** - Before context compaction (when needed)

## Additional Resources

- [Claude Code Hooks Documentation](https://code.claude.com/docs/en/hooks)
- [Hook Implementation Scripts](../../.claude/hooks/)
- [Project README](../../README.md)